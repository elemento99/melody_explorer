<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Note Generator</title>
  </head>
  <body>
    <label for="key">Select a key: </label>
    <select id="key">
      <option value="C">C</option>
      <option value="D">D</option>
      <option value="E">E</option>
      <option value="F">F</option>
      <option value="G">G</option>
      <option value="A">A</option>
      <option value="B">B</option>
    </select>

    <h1>Select the difficulty level</h1>
    <input type="range" id="difficultyLevel" min="1" max="38" value="1" />
    <span id="levelValue">Level 1</span>

    <p>Available notes: <span id="notesDisplay"></span></p>

    <label for="numNotes">Number of notes (max 50): </label>
    <input
      type="number"
      id="numNotes"
      min="1"
      max="50"
      value="4"
    />

    <button id="generateNotes">Generate Sequence</button>
    <p>Generated sequence: <span id="sequenceDisplay"></span></p>

    <script>
      const allPianoNotes = [
        'C0',
        'C#0',
        'D0',
        'D#0',
        'E0',
        'F0',
        'F#0',
        'G0',
        'G#0',
        'A0',
        'A#0',
        'B0',
        'C1',
        'C#1',
        'D1',
        'D#1',
        'E1',
        'F1',
        'F#1',
        'G1',
        'G#1',
        'A1',
        'A#1',
        'B1',
        'C2',
        'C#2',
        'D2',
        'D#2',
        'E2',
        'F2',
        'F#2',
        'G2',
        'G#2',
        'A2',
        'A#2',
        'B2',
        'C3',
        'C#3',
        'D3',
        'D#3',
        'E3',
        'F3',
        'F#3',
        'G3',
        'G#3',
        'A3',
        'A#3',
        'B3',
        'C4',
        'C#4',
        'D4',
        'D#4',
        'E4',
        'F4',
        'F#4',
        'G4',
        'G#4',
        'A4',
        'A#4',
        'B4',
        'C5',
        'C#5',
        'D5',
        'D#5',
        'E5',
        'F5',
        'F#5',
        'G5',
        'G#5',
        'A5',
        'A#5',
        'B5',
        'C6',
        'C#6',
        'D6',
        'D#6',
        'E6',
        'F6',
        'F#6',
        'G6',
        'G#6',
        'A6',
        'A#6',
        'B6',
        'C7',
        'C#7',
        'D7',
        'D#7',
        'E7',
        'F7',
        'F#7',
        'G7',
        'G#7',
        'A7',
        'A#7',
        'B7',
        'C8',
      ];

      // Function to get notes by level
      function getNotesByLevel(level) {
        const indexC4 = allPianoNotes.indexOf('C4');
        const totalNotes = level;

        let notes = [];
        const centerNotes = [
          'C4',
          'C#4',
          'D4',
          'D#4',
          'E4',
          'F4',
          'F#4',
          'G4',
          'G#4',
          'A4',
          'A#4',
          'B4',
        ];

        for (let i = 1; i <= level; i++) {
          const below = indexC4 - i;
          const above = indexC4 + i;

          if (below >= 0) notes.unshift(allPianoNotes[below]);
          if (above < allPianoNotes.length)
            notes.push(allPianoNotes[above]);
        }

        // Combine center notes and expanded notes by level
        return [...centerNotes, ...notes];
      }

      // Major scales by key
      const majorScales = {
        C: ['C', 'D', 'E', 'F', 'G', 'A', 'B'],
        D: ['D', 'E', 'F#', 'G', 'A', 'B', 'C#'],
        E: ['E', 'F#', 'G#', 'A', 'B', 'C#', 'D#'],
        F: ['F', 'G', 'A', 'A#', 'C', 'D', 'E'],
        G: ['G', 'A', 'B', 'C', 'D', 'E', 'F#'],
        A: ['A', 'B', 'C#', 'D', 'E', 'F#', 'G#'],
        B: ['B', 'C#', 'D#', 'E', 'F#', 'G#', 'A#'],
      };

      // Function to generate random notes in the selected key and level
      function generateRandomNotes(n) {
        const key = document.getElementById('key').value;
        const scale = majorScales[key];

        // Filter available notes in the selected key
        const availableNotes = allNotes.filter((note) => {
          const noteName = note.replace(/\d/, ''); // Remove note number to compare
          return scale.includes(noteName);
        });

        // Generate a random sequence of notes within the available notes
        return Array.from(
          { length: n },
          () =>
            availableNotes[
              Math.floor(Math.random() * availableNotes.length)
            ]
        );
      }

      const slider = document.getElementById('difficultyLevel');
      const levelValue = document.getElementById('levelValue');
      const notesDisplay = document.getElementById('notesDisplay');
      const sequenceDisplay = document.getElementById('sequenceDisplay');
      const numNotesInput = document.getElementById('numNotes');

      let allNotes = getNotesByLevel(1);

      // Update available notes when the level changes
      slider.addEventListener('input', function () {
        const level = parseInt(slider.value);
        allNotes = getNotesByLevel(level);
        levelValue.textContent = `Level ${level}`;
        notesDisplay.textContent = allNotes.join(', ');
      });

      // Generate and display random notes when the button is clicked
      document
        .getElementById('generateNotes')
        .addEventListener('click', function () {
          const n = Math.min(
            50,
            Math.max(1, parseInt(numNotesInput.value))
          ); // Ensure n is between 1 and 50
          const sequence = generateRandomNotes(n);
          sequenceDisplay.textContent = sequence.join(', ');
        });

      // Initialize notes when the page loads
      window.addEventListener('load', function () {
        notesDisplay.textContent = allNotes.join(', ');
      });
    </script>
  </body>
</html>
